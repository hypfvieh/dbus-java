<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/variant-handling.md at 2024-05-19
 | Rendered using Apache Maven Fluido Skin 1.12.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>dbus-java &#x2013; Using the Variant class</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.12.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.12.0.min.js"></script>
  </head>
  <body>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>dbus-java</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2024-05-19</li>
      <li id="projectVersion" class="pull-right">Version: 5.1.0-SNAPSHOT</li>
        <li class="pull-right"><span class="divider">|</span>
<a href="https://search.maven.org/search?q=g:com.github.hypfvieh%20dbus-java" class="externalLink" title="Maven Central">Maven Central</a></li>
        <li class="pull-right"><span class="divider">|</span>
<a href="https://www.github.com/hypfvieh/dbus-java/wiki" class="externalLink" title="GitHub Wiki">GitHub Wiki</a></li>
        <li class="pull-right"><a href="https://www.github.com/hypfvieh/dbus-java" class="externalLink" title="GitHub Repository">GitHub Repository</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Home"><span class="none"></span>Home</a></li>
    <li><a href="quick-start.html" title="Quickstart"><span class="none"></span>Quickstart</a></li>
    <li><a href="code-generation.html" title="Code Generation"><span class="none"></span>Code Generation</a></li>
    <li><a href="exporting-objects.html" title="Exporting Objects"><span class="none"></span>Exporting Objects</a></li>
    <li><a href="remote-objects.html" title="Calling Remote Objects"><span class="none"></span>Calling Remote Objects</a></li>
    <li><a href="properties.html" title="Properties"><span class="none"></span>Properties</a></li>
    <li class="active"><a><span class="none"></span>Variant</a></li>
    <li><a href="howto.html" title="Howto..."><span class="none"></span>Howto...</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="dbus-java-core/index.html" title="dbus-java-core"><span class="none"></span>dbus-java-core</a></li>
    <li><a href="dbus-java-osgi/index.html" title="dbus-java-osgi"><span class="none"></span>dbus-java-osgi</a></li>
    <li><a href="dbus-java-utils/index.html" title="dbus-java-utils"><span class="none"></span>dbus-java-utils</a></li>
    <li><a href="dbus-java-transport-jnr-unixsocket/index.html" title="dbus-java-transport-jnr-unixsocket"><span class="none"></span>dbus-java-transport-jnr-unixsocket</a></li>
    <li><a href="dbus-java-transport-junixsocket/index.html" title="dbus-java-transport-junixsocket"><span class="none"></span>dbus-java-transport-junixsocket</a></li>
    <li><a href="dbus-java-transport-native-unixsocket/index.html" title="dbus-java-transport-native-unixsocket"><span class="none"></span>dbus-java-transport-native-unixsocket</a></li>
    <li><a href="dbus-java-transport-tcp/index.html" title="dbus-java-transport-tcp"><span class="none"></span>dbus-java-transport-tcp</a></li>
    <li><a href="dbus-java-bom/index.html" title="dbus-java-bom"><span class="none"></span>dbus-java-bom</a></li>
    <li><a href="dbus-java-tests/index.html" title="dbus-java-tests"><span class="none"></span>dbus-java-tests</a></li>
    <li><a href="dbus-java-examples/index.html" title="dbus-java-examples"><span class="none"></span>dbus-java-examples</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Using the <code>Variant</code> class</h1><section>
<h2><a name="What_is_Variant.3F"></a>What is <code>Variant</code>?</h2>
<p>The <code>Variant&lt;?&gt;</code> class is a wrapper type used on DBus when an arbitrary type can be returned.
Like the <code>Object</code> type in Java <code>Variant&lt;?&gt;</code> can be any kind of data, starting from primitive types like
<code>int</code>, <code>boolean</code>, <code>double</code> etc. to more complex types like <code>String</code>.
To achieve this the <code>Variant</code> class is parameterized and will store the actual data type used inside of the <code>Variant&lt;?&gt;</code>.</p>
<p>One example usage of the <code>Variant&lt;?&gt;</code> type is the DBus <code>Properties</code> interface. In that case a property key
is mapped to a <code>Variant&lt;?&gt;</code> which allows mapping the key to any value.</p></section><section>
<h2><a name="Constraints_using_Variant"></a>Constraints using <code>Variant</code></h2>
<p>Using <code>Variant&lt;?&gt;</code> allows to wrap an arbitrary type. As good as this sounds it introduces some problems
regarding the usage of <code>Variant&lt;?&gt;</code> in Java.</p>
<p>When wrapping simple types, <code>Variant&lt;?&gt;</code> works like expected.
A <code>Variant&lt;String&gt;</code> will contain a <code>String</code>, a <code>Variant&lt;Integer&gt;</code> will contain an <code>Integer</code> etc.</p>
<p>The problem appears when wrapping Collections like <code>List</code> or <code>Set</code> or when using arrays.
In DBus protocol there are no Collections. The protocol only supports array.</p>
<p>When converting a <code>Variant&lt;List&lt;Integer&gt;&gt;</code> to the DBus protocol it will be translated to a compatible form
therefore the fact that a <code>List</code> was used in Java will get lost and the <code>List</code> will become an array.</p>
<p>When getting data from the bus to convert back to <code>Variant&lt;List&lt;Integer&gt;&gt;</code> the information that the Variant
should contain a <code>List</code> and not an array is already gone. From DBus standpoint the data is organized as array therefore
the Variant will contain an array of int (<code>int[]</code>) and not a <code>List&lt;Integer&gt;</code>.</p>
<p>The same result will be produced when using a <code>Variant&lt;int[]&gt;</code> - but in this case the de-serialized value
of <code>int[]</code> is the expected value.</p></section><section>
<h2><a name="How_to_put_a_Collection_.2F_Map_into_a_Variant.3C.3F.3E"></a>How to put a Collection / Map into a <code>Variant&lt;?&gt;</code></h2>
<p>Putting <code>List&lt;?&gt;</code>, <code>Set&lt;?&gt;</code> or <code>Map&lt;?, ?&gt;</code> into a <code>Variant&lt;?&gt;</code> does not work without a little help because of type erasure of Java.
While you know the actual data type of Collections or Maps while writing the code it is not available during runtime.
Therefore determining the data type used inside of the Collection/Map passed to the <code>Variant&lt;?&gt;</code> constructor is impossible.</p>
<p>To get around this limitation, you have to use another <code>Variant&lt;?&gt;</code> constructor which expects the &#x201c;signature&#x201d; as second
argument. The signature is the signature string as defined by the DBus protocol.</p>
<p>Some examples:
<code>List&lt;String&gt;</code> -&gt; &#x201c;as&#x201d;
<code>Set&lt;Integer&gt;</code> -&gt; &#x201c;ai&#x201d;
<code>Map&lt;String, Boolean&gt;</code> -&gt; &#x201c;a{sb}&#x201d;</p>
<p>As nobody can remember all of those protocol details, there is a utility <code>org.freedesktop.dbus.Marshalling.convertJavaClassesToSignature(Class&lt;?&gt;...)</code> method which will convert the given classes to the appropriate DBus signature value.</p>
<p>Sample usage:
<code>Marshalling.convertJavaClassesToSignature(List.class, String.class)</code> -&gt; &#x201c;as&#x201d;
<code>Marshalling.convertJavaClassesToSignature(Set.class, Integer.class)</code> -&gt; &#x201c;ai&#x201d;
<code>Marshalling.convertJavaClassesToSignature(Map.class, String.class, Boolean.class)</code> -&gt; &#x201c;a{sb}&#x201d;</p>
<p>Usage with <code>Variant&lt;?&gt;</code> constructor:</p>
<p><code>new Variant&lt;&gt;(List.of(&quot;foo&quot;, &quot;bar&quot;), Marshalling.convertJavaClassesToSignature(List.class, String.class))</code>;
<code>new Variant&lt;&gt;(Set.of(1, 2, 3), Marshalling.convertJavaClassesToSignature(Set.class, Integer.class))</code>;
<code>new Variant&lt;&gt;(Map.of(&quot;foo&quot;, true, &quot;bar&quot;, false), Marshalling.convertJavaClassesToSignature(Map.class, String.class, Boolean.class));</code></p></section><section>
<h2><a name="Changes_introduced_with_dbus-java_5.1.0"></a>Changes introduced with dbus-java 5.1.0</h2>
<p>Starting with dbus-java 5.1.0 the behavior of <code>Variant&lt;?&gt;</code> has been changed regarding the support of Collections and arrays.
Because the correct type cannot be known from a message on de-serialization, it is now always assumed that a <code>List</code> was
requested.</p>
<p>This means if a method or property is specified to return a Variant of int array it will be converted to a <code>Variant&lt;List&lt;Integer&gt;&gt;</code>.</p>
<p>This change may conflict with older code but allows a more consistent way to deal with <code>Variant&lt;?&gt;</code> containing Collections.</p>
<p>Therefore de-serialzation will never create a <code>Variant&lt;?&gt;</code> containing any type of array. <b>Arrays will always be</b>
<b>represented as</b> <code>List</code>.</p></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Â©      2024
</p>
        </div>
      </div>
    </footer>
<script>
  if(anchors) {
    anchors.add();
  }
</script>
  </body>
</html>
